window.__jivoOnError=function(e){if(-1===navigator.userAgent.search(/google/gi)&&-1===navigator.userAgent.search(/\+http:\/\/yandex\.com\/bots/gi))try{var t=window.location.protocol+"//err.jivosite.com/widget",n="POST",o={widget:"true",widget_version:window.jivo_version,level:2,url:window.location.href,user_agent:navigator.userAgent,lineNumber:e&&e.lineNumber,fileName:e&&e.fileName,column:e&&e.columnNumber,full_message:e&&e.stack,short_message:e&&e.message},r=new XMLHttpRequest;"withCredentials"in r?r.open(n,t,!0):"undefined"!=typeof XDomainRequest&&(r=new XDomainRequest).open(n,t),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(o))}catch(e){}},function(){window.__hasStorage=!1;try{localStorage.setItem("testLocalStorage","ok"),localStorage.removeItem("testLocalStorage"),window.__hasStorage=!0}catch(e){}function t(i,a,e,t){var l=i.console;if(l||(l={log:function(){},error:function(){}}),i.WebSocket){if(void 0===i.jivo_magic_var){i.jivo_magic_var=!0;var s,n,o,r,d,c,u,g,f,m,v,p,b={hasStorage:i.__hasStorage,jivoLoaderVersion:e,loadScript:function(e,t){var n=t||a,o=n.getElementsByTagName("script")[0],r=n.createElement("script");ie(r),o.parentNode.insertBefore(r,o).src=e},currentLoaderVersionCache:t},h=navigator.userAgent.toLowerCase(),w=/iPhone|iPad|iPod|Android|Windows Phone/i.test(h),_=a.createElement("iframe"),y=a.createElement("div"),S=0,j=5e3,C=5,I=4,N=6048e5,T=0,E=0,L=[],H=[["//cdn-fr.jivosite.com"],["//cdn-cis.jivosite.com"],["//cdn-ca.jivosite.com"]],O=!1,A={0:["default"],1:["RU","KZ","UA","BY"],2:["US","CA","AG","BS","BB","BZ","HT","GT","HN","GD","DM","DO","MX","NI","PA","SV","LC","VC","KN","TT","JM","CR","CU","AR","BR","BO","VE","GY","CO","PY","PE","SR","UY","CL","EC","AU","VU","KI","MH","FM","NR","NZ","PW","PG","WS","SB","TK","TV","FJ","PH"]},B="",k="default",M=!1,W=X();ue("Initialization"),i.__jivoBundleOnLoad=function(e){clearTimeout(d),c=e;var t=((new Date).getTime()-g)/1e3;6<t&&z("loadTime",t);z("bundleLoaded",!0),z("buildNumber",s.build_number),ue("Bundle is loaded"),function(){r=a.body.lastChild,y.style&&(y.style.opacity="0",y.style.visibility="hidden");y.setAttribute("id","jivo-iframe-container"),y.appendChild(_),r?r.parentNode.insertBefore(y,r.nextSibling):a.body.appendChild(y);G()}()},i.__jivoBundleInit=function(e){e.loaderContext=b,e.globalStore=b,function(){c=null;var e=function(e){if(e){var t=e.querySelectorAll&&e.querySelectorAll(".js-jivo-bundle");return t&&0<t.length?t:e.getElementsByClassName("js-jivo-bundle")}}(ge());{if(!e)throw l.error("Cannot get bundle script element"),new Error("Cannot get bundle script element");for(var t=0;t<e.length;t++)e[t].parentNode&&(e[t].parentNode.removeChild(e[t]),e[t]=null);e=null}}()},i.jivo_init=function(){S=0;var e=a.createEvent("Event");e.initEvent("jBeforeunload",!0,!0),i.dispatchEvent(e),J()},i.jivo_destroy=function(){S=0;var e=a.createEvent("Event");e.initEvent("jBeforeunload",!0,!0),i.dispatchEvent(e),delete i.jivo_magic_var,setTimeout(function(){y.parentNode.removeChild(y)},10)},b.getHostURL=se,b.loadConfig=x,b.store=W,b.setInStore=z,Y(),function(){(W=X()).geoWidgetInfo.widgetId&&(m=W.geoWidgetInfo.widgetId,W=X(),f=W.configHost);z("isNewCode",M),b.store=W}();var R=null,P=!1;v&&(p=v.getAttribute("nonce")),m&&f?(ue("widgetId:",m,"configHost:",f),x(K())):m&&f||l.error("Failed to evaluate the widgetId or configHost"),i.__jivoConfigOnLoad=function(e){D(e)},i.__jivoCacheDeletedWidget=function(){oe()}}}else l.log("Not supported browser");function x(e){if(L.push(e),I<++E){ue("Config load limit is exceeded"),b.hasStorage&&localStorage.removeItem("jv_loader_info_"+m);var t=new Error("Config load limit is exceeded"),n="Config urls: "+L.join(";\r\n");try{t.stack=n}catch(e){t=new Error("Config load limit is exceeded. "+n)}i.__jivoOnError(t)}else if(ue("Loading config from",e),W.deletedInfo.widgetId&&W.deletedInfo.widgetId===m&&W.deletedInfo.resolveTime&&parseInt(W.deletedInfo.resolveTime)>=(new Date).getTime())l.error("This widget is permanently removed");else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var e,t=function(e){var t;t=e.responseType&&"text"!==e.responseType?"document"===e.responseType?e.responseXML:e.response:e.responseText;return t}(r);try{if(!(e=pe(t)))throw new Error("Parse config response error")}catch(e){ue("Config is loaded as JSONP");var n=a.getElementsByTagName("script")[0],o=a.createElement("script");ie(o),o.innerHTML=t,n.parentNode.insertBefore(o,n)}e&&(ue("Config is loaded",e),D(e))}else 0!==r.status&&(ue("Config loading error"),z("geoWidgetInfo",te(null,null,null)),z("isChatStarted",null),z("configHost",null),re())},r.open("GET",e+"?rnd="+Math.random(),!0),r.send(null)}}function D(e){if(e.isDeleted)oe();else{if(f!==e.base_url&&!P)return ue("Wrong config host",f),f=e.base_url,void x(K());if(e.regions&&!W.isChatStarted){var t=function(e){var t,n,o=e.regions,r=ne(e.geoip);if(o){for(var i=Object.keys(o),a=0;a<i.length;a++)for(var l=o[i[a]],s=0;s<l.length;s++)if(1!=l.length||"default"!==l[s]){var d=ne(l[s]);if(r.country===d.country){if(r.region===d.region)return te(i[a],l[s],e.geoip);n||d.region||(n=te(i[a],l[s],e.geoip))}}else t=i[a];if(n)return n;if(t)return te(t,"default",e.geoip)}}(e);if(t.widgetId!==m)return ue("Wrong geo-widget widgetId",m),z("geoWidgetInfo",t),m=t.widgetId,void x(K())}if((R=e.ab_segment)&&R.name&&R.host&&R.staticHost&&1!==e.site_id)if(ue("AB-testing segmentation is enabled in config"),P=function(e,t){var n=W.abTesting,o=!1;o=n&&n.name===e.name?n.match:function(e,t){if(ue('Check for criteria match of test "'+e.name+'"'),e.device){var n="desktop"!==(o=e.device)?"mobile"!==o?"all"===o&&(me()||ve()):ve():me()&&!ve();if(!n)return ue('Segment "'+e.name+'" is NOT matched. Criteria: device'),!1}var o;if(e.locale){var r=e.locale===t.locale;if(!r)return ue('Segment "'+e.name+'" is NOT matched. Criteria: locale'),!1}if(e.percentage){var i=(a=e.percentage,Math.random()<=.01*a);if(!i)return ue('Segment "'+e.name+'" is NOT matched. Criteria: percentage'),!1}var a;return ue('Segment "'+e.name+'" is matched!'),!0}(e,t);return z("abTesting",{name:e.name,match:o}),o}(R,e)){ue("Ab-testing segment match! Segment:",R.name);var n="//"+R.host;ue('Setting new base_url. Was: "'+e.base_url+'". New: "'+n+'".'),e.base_url=n,ue('Setting new static_host. Was: "'+e.static_host+'". New: "'+R.staticHost+'".'),e.static_host=R.staticHost,z("availableHostInfo",{type:W.availableHostInfo.type,retriesCount:W.availableHostInfo.retriesCount,host:null})}else ue("Ab-testing segment is NOT matched");else z("abTesting",null),ue("AB-testing segmentation is NOT enabled in config"),z("configHost",f);!function(e){if(z("log",!!e.logs),i.jivo_config=s=e,void 0!==s.host_blacklist&&0<=s.host_blacklist.indexOf(i.location.host))throw ue("Host is blacklisted",i.location.host),new Error("Placing widget is forbidden on "+i.top.location.host);if(w&&s.disable_mobile)return ue("Mobile widget is disabled");{}"//cdn-jvs.jivosite.com"===s.static_host&&(O=!0);"complete"==a.readyState?U():W.bundleLoaded&&W.buildNumber==s.build_number?"interactive"==a.readyState?U():ce(i,"DOMContentLoaded",U):(z("bundleLoaded",!1),ce(i,"load",U))}(e)}}function U(){ue("Widget initialization"),function(){if("string"==typeof s.geoip&&""!==s.geoip){var e=s.geoip.split(";")[0];null!==ae(e)&&(k=e)}if(!le()){z("availableHostInfo",{type:null,retriesCount:null,host:null}),z("buildNumber",null)}var t=s.static_host?s.static_host.split("/"):[];B=t[1]?"/"+t[1]:"";var n=W.availableHostInfo;4<(T=n.retriesCount?n.retriesCount:T)&&(T=4);u=ae(k)}(),function(){ue("Iframe initialization"),_.src="javascript:void(0)",_.title="",_.role="presentation",_.allow="autoplay",_.title="Jivochat",_.setAttribute("name","jivo_container"),_.setAttribute("id","jivo_container"),_.setAttribute("frameborder","no"),y.className+="jivo-no-transition","undefined"==typeof SVGRect&&(y.className+=" no-svg");(_.frameElement||_).style.cssText="width:100%;height:100%;border:0",p&&_.setAttribute("nonce",p);i.atob&&"complete"!==a.readyState?ce(i,"load",J):J();ce(i,"message",function(e){if(e&&e.data&&"object"==typeof e.data){var t,n,o=e.data;if("in_node_webkit"==o.name&&(t||(t=e.source,n=e.origin),t&&n)){i.jivo_cobrowse={source:t,origin:n};var r="jv_"+encodeURIComponent("langpack")+"_"+s.widget_id+"="+encodeURIComponent(be(o.langpack));s.cookie_domain&&(r+="; domain="+s.cookie_domain),r+="; path=/",a.cookie=r,t.postMessage({name:"widget_ready"},n)}"iframe_url_changed"!=o.name&&"iframe_url_changed"!=o||G()}else s&&1===s.logs&&l&&l.log&&l.log("Error receive postMessage, window message event is empty.")})}()}function J(){var e=se();ue("startLoadBundle",e),(s.build_number===W.buildNumber||e===s.base_url)&&(le()||e===s.base_url)?q(e):V(e)}function V(e){var t={type:P?null:W.availableHostInfo.type,retriesCount:P?null:T,host:P?null:e};if(O)return ue("Do not ping cdn-provider",e),z("availableHostInfo",t),z("buildNumber",s.build_number),q(e);var n=new XMLHttpRequest,o=se(!0)+"/ping?rand="+(new Date).getTime();ue("Pinging host",o),n.onreadystatechange=function(){4===n.readyState&&(204===n.status?(clearTimeout(d),ue("Host is available",e),z("availableHostInfo",t),z("buildNumber",s.build_number),q(e)):0!==n.status&&(ue("Ping host error",e),de("error",e,n.status)))},n.open("GET",o,!0),n.send(null),d=setTimeout(function(){de("timeout")},j)}function q(e){ue("Insertion of bundle code from",e);var t,n,o=ge(),r=a.createElement("script"),i=(t=e,n=s.bundle_folder?s.bundle_folder:"",t+n+"/js/bundle_"+s.locale+".js?rand="+s.build_number);g=g||(new Date).getTime(),ie(r),r.className="js-jivo-bundle",r.src=i,b.bundleSrc=i,r.onerror=function(){de("error",e)},o.appendChild(r)}function G(){if(!(3<S++)){if(!c)return S--,J();try{o=_.contentWindow.document}catch(e){n=a.domain,_.src="javascript:var d=document.open();d.domain='"+n+"';void(0);",o=_.contentWindow.document}var e='<head><meta name="google" content="notranslate"><meta http-equiv="X-UA-Compatible" content="IE=edge" />'+('<script type="text/javascript" nonce="'+p+"\">window.onerror = function (message, url, lineNumber, columnNumber, error) {    if (error && error.error) {        error = error.error;    }    if (!error || !(error instanceof Error)) {        error = {};    }    if (error.stack) {        error.stack = error.message + ' ' + error.stack;    }    error.message = 'Bundle init error';    error.columnNumber = columnNumber;    error.lineNumber = lineNumber;    error.url = url;    window.parent.__jivoOnError(error);};"+c+"<\/script>")+"</head>";o.write("<!doctype HTML>"+e+'<body class="notranslate"><div id="widget"></div><div id="player"></div></body>'),o.close()}}function X(){var e={isChatStarted:null,geoWidgetInfo:{widgetId:null,clientLocation:null,region:null},configHost:null,deletedInfo:{widgetId:null,resolveTime:null},availableHostInfo:{retriesCount:null,type:null,host:null},abTesting:null,buildNumber:null,bundleLoaded:null,isNewCode:null,loadTime:null,log:null};if(b.hasStorage&&(localStorage.removeItem("jv_loader_info"),m)){var t=pe(localStorage.getItem("jv_loader_info_"+m));t&&F(t,e)}return e}function z(e,t){if(W[e]=t,b.hasStorage&&m){var n={};F(W,n),localStorage.setItem("jv_loader_info_"+m,be(n))}}function F(t,n){Object.keys(t).forEach(function(e){(function(e){if(Z(e))return!0;if("object"==typeof e){for(var t=Object.keys(e),n=0;n<t.length;n++)if(!Z(e[t[n]]))return!1;return!0}})(t[e])||(n[e]=t[e])})}function Z(e){return null===e&&"object"==typeof e}function K(){return f+"/script/widget/config/"+m}function Y(){v=a.currentScript?a.currentScript:a.querySelector("script[jv-id]")||a.querySelector("script[data-jv-id]");var e=function(){if(v)return v.src;try{throw new Error("Get script URL")}catch(e){var t=e.stack;if(t){var n=Q(t),o=$(t),r=ee(t);return n?n[0]:o?o[0]:r?r[0]:null}}}(),t=Q(e),n=$(e),o=ee(e);f||(t?(f="//"+t[1],M=!0):n?f="//"+n[1]:o&&(f="//"+o[1])),m||(n&&n[2]?(m=n[2],M=!0):o&&o[2]?(m=o[2],M=!1):(M=!0,m=v.getAttribute("jv-id")||v.getAttribute("data-jv-id")))}function Q(e){return e&&e.match(/https?:\/\/(\S+)\/widget\.js/)}function $(e){return e&&e.match(/https?:\/\/(\S+)\/script\/widget\/([A-Za-z0-9]+)/)}function ee(e){return e&&e.match(/https?:\/\/(\S+)\/script\/geo-widget\/([A-Za-z0-9]+)/)}function te(e,t,n){return{widgetId:e,region:t,clientLocation:n}}function ne(e){if("string"==typeof e&&""!==e){var t=e.split(";");return{country:t[0],region:t[1],city:t[2]}}}function oe(){ue("Widget was removed",m),z("configHost",null),W.geoWidgetInfo.widgetId||W.isChatStarted?(z("geoWidgetInfo",te(null,null,null)),z("isChatStarted",null),re()):(z("deletedInfo",{widgetId:m,resolveTime:((new Date).getTime()+N).toString()}),l.error("This widget is permanently removed"))}function re(){f=m=null,Y(),x(K())}function ie(e){return e.type="text/javascript",e.async=!0,e.charset="UTF-8",p&&e.setAttribute("nonce",p),e}function ae(t){var e=Object.keys(A),n=null;return e.forEach(function(e){n||-1!==A[e].indexOf(t)&&(n=e)}),n}function le(){var e=W.availableHostInfo;return W.buildNumber===s.build_number&&e.host}function se(e){var t=e?"":B;return s.static_host?O?s.static_host:le()?W.availableHostInfo.host:0===T?(u=ae(k),H[u]+t):1===T?(u=function e(t,n){var o=Object.keys(t);var r=(i=o,i[Math.floor(Math.random()*i.length)]);var i;return r===n?e(t,n):r}(A,u),H[u]+t):s.base_url:s.base_url}function de(e,t,n){if(clearTimeout(d),++T>=C){ue("Bundle load retries count is exceeded");var o=new Error("Bundle NOT loaded. Type: "+e+(t?". Host: "+t:"")+(n?". Status code: "+n:""));i.__jivoOnError(o)}else{var r={type:e,retriesCount:T,host:null};W.availableHostInfo=r,J()}}function ce(e,t,n){var o;e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&(e.attachEvent("on"+t,(o=e,function(){n.call(o,i.event)})),e=null)}function ue(){if(W.log){var e=Array.prototype.slice.call(arguments||[]);e.unshift("Loader:"),l.log.apply(l,e)}}function ge(){var e=a.head||a.getElementsByTagName("head")[0];if(!e)throw l.error("Cannot get document head element"),new Error("Cannot get document head element");return e}function fe(e){return-1!==h.indexOf(e)}function me(){return fe("chrome")&&!fe("opr/")&&"Google Inc."===i.navigator.vendor}function ve(){return!fe("windows")&&fe("android")}function pe(e){return i.MooTools&&void 0===JSON.parse?JSON.decode(e):JSON.parse(e)}function be(e){return i.MooTools&&void 0===JSON.stringify?JSON.encode(e):JSON.stringify(e)}}var n=t,e=null;if(window.__hasStorage){try{e=JSON.parse(localStorage.getItem("__jivoLoader"))}catch(e){e.message="Loader parse error",window.__jivoOnError(e)}e&&.1<e.version&&(n=new Function("window","document","broswerCacheLoaderVersion","currentLoaderVersionCache","("+e.code+")(window, document, broswerCacheLoaderVersion, currentLoaderVersionCache)"))}try{n(window,document,.1,e?e.version:.1)}catch(e){e.message=e.message?"Loader error. "+e.message:"Loader error",window.__jivoOnError(e),delete window.jivo_magic_var,(n=t)(window,document,.1,.1)}}();